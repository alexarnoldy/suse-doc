<<<

include::./varsLab2.adoc[]

== Turn Signal On, Ready to Merge
Understand the basics of how to efficiently, manually interact with Kubernetes and an application deployment over the lifecycle of an application.

// TIP: For a brief overview of the architectural components being leveraged in these lab exercises, refer to the provided presentation and the FixMe document.

Goals / Objectives ( Estimate time 35 - 45 minutes )::
Learn how to manually inspect, launch, scale and update a Kubernetes Deployment object. See https://kubernetes.io/docs/tutorials/kubernetes-basics/[Kubernetes Basics] for more examples/details.
+
WARNING: To reduce confusion, the assumption is that the respective Kubernetes cluster being used does not have any extraneous, non-core microservices running. So please cleanup previous or other lab exercise attempts before proceeding.

Assumptions::
The example commands provided in this exercise use the full syntax and option names. Alternative ways with abbreviated syntax options are listed below the main command line entries.

Environment::
The following diagram shows the infrastructure components of the lab environment
 which you will interact with.
+
[[img-Lab2-app-lifecycle]]
.Application Launch Environment
image::Lab2-app-lifecycle.png[Lab2-app-lifecycle, 640, 480]

Process::
Login to your student workstation ( *<user>* : _{hostUID}_ , *<password>* : _{hostPW}_ )
+
* From the graphical user interface application dock at the bottom of your screen, launch a Terminal.
* In the terminal window, login to the lab environment's "Access Node" using secure shell (`ssh`) by typing
+
[subs="attributes"]
----
ssh {clusterUID}@{clusterAdmIP}
----
+
using the *<password>* _{clusterPW}_
+
NOTE: All of the following process steps should be completed while logged into this lab environment's "Access Node" as mentioned above!
+
* Exercise - Preview and launch the {AuthorGHURL}/{Lab2-dir}/{Lab2Launch-manifest}[application deployment manifest]
. From the shell prompt, view manifest for the application that is going to be deployed
+
[subs="attributes"]
----
cat {Lab2-dir}/{Lab2Launch-manifest}
----
+
 **QUIZ**
 a) What is the name of the deployment?
 b) How many replica sets will be running?
 c) Which container image:version will be used for the pods?
+
. Create the application deployment from the designated manifest
+
[subs="attributes"]
----
kubectl create --filename={Lab2-dir}/{Lab2Launch-manifest}
----
+
TIP: An abbreviated version of this command would be `kubectl create -f <manifestFilename>`
+
. Check your answers to the *QUIZ* above, for your active deployment
+
[subs="attributes,verbatim"]
----
kubectl get deployments <1>
kubectl get replicasets <2>
kubectl get pods <3>
----
<1> https://kubernetes.io/docs/concepts/workloads/controllers/deployment/[Kubernetes Deployments]
<2> https://kubernetes.io/docs/concepts/workloads/controllers/replicaset/[Kubernetes ReplicaSet]
<3> https://kubernetes.io/docs/concepts/workloads/pods/pod/[Kubernetes Pods]
+
TIP: An abbreviated version of the 'replicasets' commands would be `kubectl get rs`
+
At this point, you should be able to mentally map the previous command outputs to a graphical representation, shown below, of the specific deployment.
+
[[img-L2-nginx-deployment]]
.Application Deployment
image::NGINX-Deployment.png[NGNIX-MySQL-Deployment, 640, 480]
+
* Exercise - Explore further details of your application deployment components
. Continuing with the previous application deployment, obtain a more detailed view of each of the components
+
[subs="attributes"]
----
kubectl describe deployments
kubectl describe replicasets
kubectl describe pods
----
+
 **QUIZ**
 a) Have any replicaset pods failed?
 b) What container port and IP address are associated with one of the pods?
+
* Exercise - Show how Kubernetes maintains the specified number of replica set pods
. Get a view of the currently running pods that are part of the replica set
+
[subs="attributes"]
----
kubectl get pods
----
+
. Let's target the last one on the previous commands output. Cut and past the fifirst column, and substitute that string for *<nginx-deployment-ID>* in the command below
+
[subs="attributes,verbatim"]
----
kubectl delete pod <nginx-deployment-ID>
----
+
The resulting output should convey that the pod was deleted.
. Now verify that Kubernetes dealt with that issue, ensure that two pods are always running for your specified replica set
+
[subs="attributes"]
----
kubectl get pods
kubectl get replicasets
----
+
As you might see, a new pod *<ID>* has been created to keep the desired count running (and one of the original pair that you did not delete is still running as well).
* Exercise - Manually scale your application deployment
. View changes in proposed {AuthorGHURL}/{Lab2-dir}/{Lab2Scale-manifest}[deployment] manifest, compared to the original one
+
[subs="attributes"]
----
diff {Lab2-dir}/{Lab2Launch-manifest} {Lab2-dir}/{Lab2Scale-manifest}
----
+
 **QUIZ**
 a) Which attribute is being modified?
+
. Check the current state
+
[subs="attributes"]
----
kubectl get replicasets
kubectl get pods
----
+
. Scale the application deployment's replicasets by applying the updated manifest
+
[subs="attributes"]
----
kubectl apply --filename={Lab2-dir}/{Lab2Scale-manifest}
----
+
. Confirm the expected results
+
[subs="attributes"]
----
kubectl get replicasets
kubectl get pods
----
+
 **Bonus QUIZ**
 a) How might you scale down the deployment back to the original configuration?
+
* Exercise - Update your application using a new container image version
. View changes in proposed {AuthorGHURL}/{Lab2-dir}/{Lab2Update-manifest}[deployment] manifest, compared to the previous, scaling one
+
[subs="attributes"]
----
diff {Lab2-dir}/{Lab2Scale-manifest} {Lab2-dir}/{Lab2Update-manifest}
----
+
 **QUIZ**
 a) Which attributes are being modified?
+
. Check the current state
+
[subs="attributes"]
----
kubectl describe deployments
kubectl describe replicasets
kubectl describe pods
----
+
NOTE: In `kubectl get deployments` output, you will notice that the scaling events has been recorded and logged.
+
. Update the application container image with a newer version
+
[subs="attributes"]
----
kubectl apply --filename={Lab2-dir}/{Lab2Update-manifest}
----
+
. Confirm the expected results
+
[subs="attributes"]
----
kubectl describe deployments
kubectl describe replicasets
kubectl describe pods
----
+
 **QUIZ**
 a) How could you downgrade the container image version back down to the original configuration?
+
NOTE: One can also accomplish such updates with `kubectl set` or with `kubectl edit`. For those approaches, refer to https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#updating-a-deployment[Kubernetes-Workloads-Controllers-Deployments] documentation.
+
* FixMe _Optional / Advanced Exercises_* - If you have some spare time, or are curious about the commands used or what was deployed, try:
** K9s
** K8s Dashboard

IMPORTANT: Ensure that you clean up all your application deployments to return to a known, clean state. Delete the running deployment and check that all the other objects are gone as well.

[subs="attributes"]
----
kubectl delete --filename={Lab2-dir}/{Lab2Update-manifest}
kubectl get deployments
kubectl get replicasets
kubectl get pods
----

Knowledge Check::
Initial introduction to the Kubernetes Deployment object
+
* launching and exploring the deployment components
* scaling and updating selected deployment components
* deleting the deployment

